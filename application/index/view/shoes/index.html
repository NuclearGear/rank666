{include file="public/header"}
<!-- Page Container -->
<div class="page-container">
    <!-- Page Sidebar -->
    {include file="public/sidebar"}
    <!-- /Page Sidebar -->

    <!-- Page Content -->
    <div class="page-content">
        <!-- Page Header -->
        {include file="public/page_header"}
        <!-- /Page Header -->
        <!-- Page Inner -->
        <div class="page-inner">
            <div id="main-wrapper">
                <div class="row">
                    <div class="col-md-12">
                        <div class="alert alert-default" role="alert">
                            公告：每日 6:00 更新数据
                        </div>
                    </div>
                </div>

                <!-- 搜索框 -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-white">
                            <div class="panel-body">

                                <!-- 搜索框 -->
                                <div class="row">
                                    <div class="col-md-6">
                                    <div class="panel-heading clearfix">
                                        <h4 class="panel-title">输入你要查找的鞋子: 货号 或 名称</h4>
                                    </div>
                                    <div class="panel-body">
                                        <div class="input-group">
                                            <select class="form-control select_name" data-live-search="true" style="width: 100%;">
                                                <option value="">无</option>
                                            </select>
                                            <div class="input-group-btn">
                                                <button type="button" class="btn btn-info dropdown-toggle sure-btn"
                                                        data-toggle="dropdown" aria-expanded="false">
                                                    <span class="fa fa-search"></span>查找
                                                </button>
                                            </div>
                                        </div>
                                        <div class="alert alert-danger ret-msg" role="alert" style="margin-bottom:0;margin-top:10px;display: none">

                                        </div>
                                        <!-- Split button -->
                                        <div class="btn-group">

                                        </div>
                                    </div>
                                    </div>
                                </div>
                                <!-- 搜索框 -->


                                <!-- 商品标题 -->
                                <div class="panel-heading clearfix">
                                    <h4 class="panel-title">
                                        <span class="product-title"></span>
                                    </h4>
                                </div>
                                <!-- 商品标题 -->

                                <!-- 商品详细信息 -->
                                <div class="row">
                                    <div class="col-md-2">
                                        <img class="product-image" src="" width="200">
                                    </div>
                                    <div class="col-md-2">
                                        <form class="form-horizontal">
                                            <div class="form-group">
                                                <div style="margin-top:10px;" class="input-group">
                                                    <span class="input-group-addon">货号</span>
                                                    <input type="text" class="form-control product-articleNumber" readonly="readonly" aria-label="Amount (to the nearest dollar)">
                                                </div>
                                                <div style="margin-top:15px;" class="input-group">
                                                    <span class="input-group-addon">发售</span>
                                                    <input type="text" class="form-control product-sellDate" readonly="readonly" aria-label="Amount (to the nearest dollar)">
                                                </div>
                                                <div style="margin-top:15px;" class="input-group">
                                                    <span class="input-group-addon">销量</span>
                                                    <input type="text" class="form-control product-soldNum" readonly="readonly" aria-label="Amount (to the nearest dollar)">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="btn-group btn-group-justified" role="group"
                                             aria-label="Justified button group">
                                            <div class="row fontawesome-icon-list sold-list">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- 商品详细信息 -->


                            </div>
                        </div>
                    </div>
                </div>
                <!-- 搜索框 -->


                <!-- 走势图 -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-white">
                            <div class="panel-heading clearfix">
                                <h4 class="panel-title">提示：为了方便观看 只显示 40 - 44 的尺码。需要显示其他尺码话, 可以点击对应尺码</h4>
                            </div>
                            <div class="panel-body">
                                <div role="tabpanel">
                                    <!-- Nav tabs -->
                                    <ul class="nav nav-tabs nav-justified" role="tablist">
                                        <li role="presentation" class="active"><a href="#tab21" role="tab" data-toggle="tab">价格走势图</a></li>
                                        <li role="presentation"><a href="#tab22" role="tab" data-toggle="tab">销量走势图</a></li>
                                    </ul>
                                    <!-- Tab panes -->
                                    <div class="tab-content">
                                        <div role="tabpanel" class="tab-pane active fade in" id="tab21">
                                            <div id="echart_1" style="height: 800px;">

                                            </div>
                                        </div>
                                        <div role="tabpanel" class="tab-pane active fade" id="tab22">
                                            <div id="echart_2" style="height: 800px;">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 走势图 -->



            </div><!-- Main Wrapper -->
        </div><!-- /Page Inner -->

    </div><!-- /Page Content -->
</div><!-- /Page Container -->


{include file="public/script"}
{include file="public/footer"}


<script>
    // 遍历插入商品
    $(function () {
        $.get("{:url('buy/ajax_get_goods')}",{},function (ret) {
            layer.load();

            if (ret.code == 200){
                var dom = '';
                $.each(ret.data,function (k, v) {
                    dom += "<option value=\"" +  v['articleNumber'] + "\">"+ v['articleNumber'] + ' ' + v['title'] +"</option>";
                });
                $('.select_name').append(dom);
                $('.select_name').selectpicker({
                    size:15,
                    title:'请输入名称 或 货号',
                    placeholder:'请输入名称 或 货号',
                });

                $('.select_name').selectpicker('val', '{$data.articleNumber}');
                $('.sure-btn').click();
            }
            layer.closeAll('loading');
        });
    });

    // enter 键
    $("body").keydown(function () {
        if (event.keyCode == "13") {
            $('.sure-btn').click();
        }
    });


    // 确认搜索 获取折线图
    $('.sure-btn').click(function () {
        layer.load();

        var myChart = echarts.init(document.getElementById('echart_1'));
        var myChart2 = echarts.init(document.getElementById('echart_2'));

        var day = $('.day').val();
        var articleNumber = $('.select_name').selectpicker('val');


        var form_data = {
            'day'           : day,
            'size_start'    : '{$data.size_start}',
            'size_end'      : '{$data.size_end}',
            'articleNumber' : articleNumber,
        };

        $.get("{:url('shoes/AjaxProductOne')}", form_data, function (ret) {
            if (ret.code != 200) {
                layer.closeAll('loading');
                $('.ret-msg').html(ret.msg).show();
                return false;
            }
            $('.ret-msg').hide();

            $('.product-sellDate').val(ret['data']['product']['sellDate']);           // 发售日期
            $('.product-articleNumber').val(ret['data']['product']['articleNumber']); // 货号
            $('.product-soldNum').val(ret['data']['product']['soldNum']);             // 总销量
            $('.product-title').html(ret['data']['product']['title']);                           // 名称
            $('.product-image').attr('src', ret['data']['product']['image']);                    // 图片


            // 尺码销量
            sizeDom = '';
            $('.sold-list').empty();
            ret['data']['soldList'].forEach(function (v, k) {
                sizeDom = '<div class="fa-hover col-sm-2">\n' +
                    '                                            <div class="btn-group" style="width: 100%">\n' +
                    '                                                <button type="button" class="btn btn-primary" style="width: 40%">' + v['size'] + '</button>\n' +
                    '                                                <button type="button" class="btn btn-default" style="width: 60%">' + v['soldNum'] + '</button>\n' +
                    '                                            </div>\n' +
                    '                                        </div>';
                $('.sold-list').append(sizeDom)
            });

            option = {
                title: {
                    text: ret.data['product']['title'],
                    top: 40,
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    type: 'scroll',
                    data: ret.data['sizeName'],
                    selected:ret.data['sizeSelected']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top:'13%',
                    containLabel: true
                },
                toolbox: {
                    top:'5%',
                    show: true,
                    feature: {
                        dataZoom: {
                            yAxisIndex: 'none'
                        },
                        dataView: {readOnly: false},
                        magicType: {type: ['line', 'bar']},
                        restore: {},
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ret.data['time']
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value} 元'
                    },
                    min: function (value) {
                        return value.min - 500;
                    },
                    max: function (value) {
                        return value.max + 500;
                    }
                },
                series: ret.data['sizeList']
            };
            myChart.setOption(option)


            option2 = {
                title: {
                    text: ret.data['product']['title'],
                    top: 40,
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    type: 'scroll',
                    data: ret.data['soldSizeName'],
                    selected:ret.data['soldSelected']
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    top:'13%',
                    containLabel: true
                },
                toolbox: {
                    top:'5%',
                    show: true,
                    feature: {
                        dataZoom: {
                            yAxisIndex: 'none'
                        },
                        dataView: {readOnly: false},
                        magicType: {type: ['line', 'bar']},
                        restore: {},
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ret.data['soldTime']
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value} 双'
                    },
                    min: function (value) {
                        return value.min - 50;
                    },
                    max: function (value) {
                        return value.max + 50;
                    }
                },
                series: ret.data['soldSizeList']
            };
            myChart2.setOption(option2);
            $('.tab-pane').eq(1).removeClass('active');
            layer.closeAll('loading');
        });
    });
</script>
<!-- 统计代码 -->
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1276403292'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1276403292' type='text/javascript'%3E%3C/script%3E"));</script>
